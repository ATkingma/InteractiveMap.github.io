<!DOCTYPE html>
<html>

<head>
    <title>Arena Breakout Interactive Map</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Leaflet's CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@latest/dist/leaflet.css" crossorigin="" />

    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@latest/dist/leaflet.js" crossorigin=""></script>

    <!-- Grouping markers to cluster -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@latest/dist/MarkerCluster.css" crossorigin="" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@latest/dist/MarkerCluster.Default.css" crossorigin="" />
    <script src="https://unpkg.com/leaflet.markercluster@latest/dist/leaflet.markercluster.js" crossorigin=""></script>

    <!-- Nested marker cluster -->
    <script src="https://unpkg.com/leaflet.featuregroup.subgroup@latest/dist/leaflet.featuregroup.subgroup.js" crossorigin=""></script>

    <!-- Interactive sidebar -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-sidebar-v2@latest/css/leaflet-sidebar.min.css" />
    <script src="https://unpkg.com/leaflet-sidebar-v2@latest/js/leaflet-sidebar.min.js"></script>

    <!-- Leaflet editing tools -->
    <link rel="stylesheet" href="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.css" crossorigin="" />
    <script src="https://unpkg.com/@geoman-io/leaflet-geoman-free@latest/dist/leaflet-geoman.min.js" crossorigin=""></script>

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />

    <link rel="stylesheet" href="../src/css/leaflet-style.css" />
</head>

<body>
    <!-- Top Ad Space -->
    <div id="top-ad" class="ad-space top-ad">
        <div class="ad-content">
            <h3>Premium Ad Spot</h3>
            <p>Your advertisement here - Top banner space</p>
        </div>
    </div>

    <!-- Main Content Area -->
    <div id="main-content">
        <!-- Bottom Ad Space (moved above map) -->
        <div id="bottom-ad" class="ad-space bottom-ad above-map">
            <div class="ad-content">
                <h3>Featured Advertisement</h3>
                <p>Your advertisement here - Featured banner space</p>
            </div>
        </div>

        <div id="sidebar" class="leaflet-sidebar collapsed">
            <!-- Expand button for collapsed sidebar -->
            <button class="sidebar-expand-btn" onclick="openSidebar()">
                <i class="fas fa-chevron-right"></i>
            </button>
            
            <!-- Nav tabs -->
            <div class="leaflet-sidebar-tabs">
                <ul role="tablist">
                    <li><a href="#markers" role="tab"><i class="fas fa-map-marker-alt"></i></a></li>
                    <li><a href="#filters" role="tab"><i class="fas fa-filter"></i></a></li>
                    <li><a href="#floors" role="tab"><i class="fas fa-building"></i></a></li>
                    <li><a href="#create" role="tab"><i class="fas fa-plus"></i></a></li>
                </ul>

                <ul role="tablist">
                    <li><a href="#coordinates" role="tab"><i class="fas fa-crosshairs"></i></a></li>
                    <li><a href="#reset" role="tab"><i class="fas fa-trash"></i></a></li>
                    <li><a href="#edit" role="tab"><i class="fas fa-map-marked"></i></a></li>
                    <li><a href="#attributions" role="tab"><i class="fas fa-info-circle"></i></a></li>
                </ul>
            </div>

            <!-- Tab panes -->
            <div class="leaflet-sidebar-content">
                <!-- Markers Panel -->
                <div class="leaflet-sidebar-pane" id="markers">
                    <h1 class="leaflet-sidebar-header">
                        Map Markers
                        <span class="leaflet-sidebar-close"><i class="fas fa-caret-left"></i></span>
                    </h1>
                    <div class="markers-container">
                        <div class="marker-controls">
                            <button id="toggle-all-markers" class="control-btn">
                                <i class="fas fa-eye"></i> Toggle All
                            </button>
                            <button id="clear-custom-markers" class="control-btn danger">
                                <i class="fas fa-trash"></i> Clear Custom
                            </button>
                        </div>
                        <div id="marker-categories"></div>
                    </div>
                </div>

                <!-- Filters Panel -->
                <div class="leaflet-sidebar-pane" id="filters">
                    <h1 class="leaflet-sidebar-header">
                        Item Filters
                        <span class="leaflet-sidebar-close"><i class="fas fa-caret-left"></i></span>
                    </h1>
                    <div class="filters-container">
                        <div class="filter-section">
                            <h3>Loot Type</h3>
                            <div id="loot-type-filters"></div>
                        </div>
                        <div class="filter-section">
                            <h3>Rarity</h3>
                            <div id="rarity-filters"></div>
                        </div>
                        <div class="filter-section">
                            <h3>Location</h3>
                            <div id="location-filters"></div>
                        </div>
                        <div class="filter-controls">
                            <button id="apply-filters" class="control-btn primary">
                                <i class="fas fa-check"></i> Apply Filters
                            </button>
                            <button id="clear-filters" class="control-btn">
                                <i class="fas fa-times"></i> Clear All
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Floors Panel -->
                <div class="leaflet-sidebar-pane" id="floors">
                    <h1 class="leaflet-sidebar-header">
                        Floor Selection
                        <span class="leaflet-sidebar-close"><i class="fas fa-caret-left"></i></span>
                    </h1>
                    <div class="floors-container">
                        <div class="floor-info">
                            <p>Switch between different map floors and levels</p>
                        </div>
                        <div class="floor-selector-container">
                            <label for="floor-select">Current Floor:</label>
                            <select id="floor-select">
                                <option value="ground">Ground Floor</option>
                                <option value="basement1">Basement Level 1</option>
                                <option value="basement2">Basement Level 2</option>
                                <option value="floor1">Floor 1</option>
                                <option value="floor2">Floor 2</option>
                            </select>
                        </div>
                        <div class="floor-preview">
                            <div id="current-floor-info">
                                <strong>Ground Floor</strong>
                                <p>Main level with primary locations</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Create Marker Panel -->
                <div class="leaflet-sidebar-pane" id="create">
                    <h1 class="leaflet-sidebar-header">
                        Create Marker
                        <span class="leaflet-sidebar-close"><i class="fas fa-caret-left"></i></span>
                    </h1>
                    <div class="create-container">
                        <div class="create-instructions">
                            <p><i class="fas fa-info-circle"></i> Click on the map to place a new marker</p>
                        </div>
                        <form id="marker-form">
                            <div class="form-group">
                                <label for="marker-name">Marker Name:</label>
                                <input type="text" id="marker-name" placeholder="Enter marker name" required>
                            </div>
                            <div class="form-group">
                                <label for="marker-description">Description:</label>
                                <textarea id="marker-description" placeholder="Enter description"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="marker-type">Loot Type:</label>
                                <select id="marker-type">
                                    <option value="weapons">Weapons</option>
                                    <option value="armor">Armor</option>
                                    <option value="medical">Medical</option>
                                    <option value="ammo">Ammo</option>
                                    <option value="equipment">Equipment</option>
                                    <option value="supplies">Supplies</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="marker-rarity">Rarity:</label>
                                <select id="marker-rarity">
                                    <option value="common">Common</option>
                                    <option value="rare">Rare</option>
                                    <option value="epic">Epic</option>
                                    <option value="legendary">Legendary</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="marker-icon">Icon:</label>
                                <select id="marker-icon">
                                    <option value="fas fa-crosshairs">Crosshairs</option>
                                    <option value="fas fa-shield-alt">Shield</option>
                                    <option value="fas fa-plus">Medical</option>
                                    <option value="fas fa-box">Box</option>
                                    <option value="fas fa-star">Star</option>
                                    <option value="fas fa-flag">Flag</option>
                                    <option value="fas fa-exclamation">Exclamation</option>
                                </select>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="control-btn primary">
                                    <i class="fas fa-plus"></i> Create Marker
                                </button>
                                <button type="button" id="cancel-create" class="control-btn">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                            </div>
                        </form>
                        <div id="custom-markers-list">
                            <h3>Custom Markers</h3>
                            <div id="custom-markers-container"></div>
                        </div>
                    </div>
                </div>

                <!-- Coordinates Panel -->
                <div class="leaflet-sidebar-pane" id="coordinates">
                    <h1 class="leaflet-sidebar-header">
                        Coordinates & Position
                        <span class="leaflet-sidebar-close"><i class="fas fa-caret-left"></i></span>
                    </h1>
                    <div class="coordinates-container">
                        <div class="coordinate-display">
                            <h3>Current Mouse Position</h3>
                            <div class="coord-info">
                                <div class="coord-item">
                                    <label>X:</label>
                                    <span id="current-x">0</span>
                                </div>
                                <div class="coord-item">
                                    <label>Y:</label>
                                    <span id="current-y">0</span>
                                </div>
                            </div>
                        </div>
                        <div class="coordinate-tools">
                            <h3>Go to Coordinates</h3>
                            <div class="goto-coords">
                                <input type="number" id="goto-x" placeholder="X coordinate">
                                <input type="number" id="goto-y" placeholder="Y coordinate">
                                <button id="goto-button" class="control-btn primary">
                                    <i class="fas fa-location-arrow"></i> Go to Position
                                </button>
                            </div>
                        </div>
                        <div class="coordinate-info">
                            <h3>Selected Marker</h3>
                            <div id="selected-marker-coords">
                                <p>Click on a marker to see its coordinates</p>
                            </div>
                        </div>
                        <div class="coordinate-export">
                            <h3>Export Tools</h3>
                            <button id="copy-coords" class="control-btn">
                                <i class="fas fa-copy"></i> Copy Current Position
                            </button>
                            <button id="export-json" class="control-btn">
                                <i class="fas fa-download"></i> Export Markers as JSON
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Reset Panel -->
                <div class="leaflet-sidebar-pane" id="reset">
                    <h1 class="leaflet-sidebar-header">
                        Reset Options
                        <span class="leaflet-sidebar-close"><i class="fas fa-caret-left"></i></span>
                    </h1>
                    <div class="reset-container">
                        <p>Reset map view and clear selections</p>
                        <button id="reset-view" class="control-btn">
                            <i class="fas fa-home"></i> Reset View
                        </button>
                        <button id="clear-selection" class="control-btn">
                            <i class="fas fa-times-circle"></i> Clear Selection
                        </button>
                    </div>
                </div>

                <!-- Edit Panel -->
                <div class="leaflet-sidebar-pane" id="edit">
                    <h1 class="leaflet-sidebar-header">
                        Edit Mode
                        <span class="leaflet-sidebar-close"><i class="fas fa-caret-left"></i></span>
                    </h1>
                    <div class="edit-container">
                        <p>Toggle edit mode for markers and map elements</p>
                        <button id="toggle-edit" class="control-btn">
                            <i class="fas fa-edit"></i> Toggle Edit Mode
                        </button>
                    </div>
                </div>

                <!-- Attributions Panel -->
                <div class="leaflet-sidebar-pane" id="attributions">
                    <h1 class="leaflet-sidebar-header">
                        About & Credits
                        <span class="leaflet-sidebar-close"><i class="fas fa-caret-left"></i></span>
                    </h1>
                    <div class="attributions-container">
                        <h3>Arena Breakout Interactive Map</h3>
                        <p>Enhanced interactive map with custom markers and filtering</p>
                        <h4>Technologies Used:</h4>
                        <ul>
                            <li>Leaflet.js for mapping</li>
                            <li>Font Awesome for icons</li>
                            <li>Custom marker system</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="map"></div>
    </div>

    <!-- include classes -->
    <script src="../src/js/leaflet/custom_layers.js" type="text/javascript"></script>
    <script src="../src/js/leaflet/interactive_layer.js" type="text/javascript"></script>
    <script src="../src/js/leaflet/interactive_map.js" type="text/javascript"></script>
    <script src="../src/js/leaflet/share_marker.js" type="text/javascript"></script>
    <script src="../src/js/leaflet/utils.js" type="text/javascript"></script>
    <script src="../src/js/leaflet/floor_control.js" type="text/javascript"></script>
    <script src="../src/js/leaflet/enhanced_map_features.js" type="text/javascript"></script>

    <!-- include marker data -->
    <script src="../src/js/leaflet/marker/armory_loot.js" type="text/javascript"></script>
    <script src="../src/js/leaflet/marker/farm_loot.js" type="text/javascript"></script>
    <script src="../src/js/leaflet/marker/northridge_loot.js" type="text/javascript"></script>
    <script src="../src/js/leaflet/marker/tvstation_loot.js" type="text/javascript"></script>
    <script src="../src/js/leaflet/marker/valley_loot.js" type="text/javascript"></script>
    <script src="../src/js/leaflet/marker/spawn_points.js" type="text/javascript"></script>

    <!-- include layer logic -->
    <script src="../src/js/leaflet/marker_logic/armory_loot.js" type="text/javascript"></script>
    <script src="../src/js/leaflet/marker_logic/farm_loot.js" type="text/javascript"></script>
    <script src="../src/js/leaflet/marker_logic/northridge_loot.js" type="text/javascript"></script>
    <script src="../src/js/leaflet/marker_logic/tvstation_loot.js" type="text/javascript"></script>
    <script src="../src/js/leaflet/marker_logic/valley_loot.js" type="text/javascript"></script>
    <script src="../src/js/leaflet/marker_logic/spawn_points.js" type="text/javascript"></script>

    <!-- include map specific stuff -->
    <script src="../src/js/leaflet/arena_breakout_map.js" type="text/javascript"></script>
    
    <script>
        // Simple function to open sidebar
        function openSidebar() {
            var sidebar = document.getElementById('sidebar');
            if (sidebar.classList.contains('collapsed')) {
                sidebar.classList.remove('collapsed');
            }
        }
        
        // Update expand button icon based on sidebar state
        function updateExpandButton() {
            var sidebar = document.getElementById('sidebar');
            var expandBtn = document.querySelector('.sidebar-expand-btn i');
            if (expandBtn) {
                if (sidebar.classList.contains('collapsed')) {
                    expandBtn.className = 'fas fa-chevron-right';
                } else {
                    expandBtn.className = 'fas fa-chevron-left';
                }
            }
        }
        
        // Watch for sidebar state changes
        if (window.MutationObserver) {
            var observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        updateExpandButton();
                    }
                });
            });
            
            document.addEventListener('DOMContentLoaded', function() {
                var sidebar = document.getElementById('sidebar');
                if (sidebar) {
                    observer.observe(sidebar, {
                        attributes: true,
                        attributeFilter: ['class']
                    });
                    updateExpandButton();
                }
            });
        }
    </script>
</body>

</html>
